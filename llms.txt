# trisk.analysis

[![R-CMD-check](https://github.com/Theia-Finance-Labs/trisk.utils/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/Theia-Finance-Labs/trisk.utils/actions/workflows/R-CMD-check.yaml)

The goal of trisk.analysis is to provide a tool that can be used to
conduct what-if climate stress test analyses for financial institutions,
supervisors, regulators and other stakeholders. The tool aims at
highlighting potential financial risk in especially climate relevant
sectors, split by production technology where required. The core Trisk
model source code is available in another package, already included in
the installation of this one. Specific documentation and source code
related links is available on
[trisk.model](https://theia-finance-labs.github.io/trisk.model/index.html)
.

- [trisk.analysis](#triskanalysis)
  - [Use the package](#use-the-package)
    - [Installation](#installation)
    - [Input and output dataframes
      columns](#input-and-output-dataframes-columns)
    - [Scenarios data](#scenarios-data)
  - [Analyses](#analyses)
    - [Portfolio analysis](#portfolio-analysis)
    - [Sensitivity analysis](#sensitivity-analysis)
  - [Funding](#funding)

## Use the package

### Installation

You can install this package directly from GitHub using the `pak`
package in R.

1.  Install the `pak` package if you don’t have it:

    ``` r
    install.packages("pak")
    ```

2.  Install the package from GitHub:

    ``` r
    pak::pak("Theia-Finance-Labs/trisk.analysis")
    ```

### Input and output dataframes columns

There are 4 input datasets (assets, scenarios, financial_features,
ngfs_carbon_prices), and 3 output datasets (npv_results, pd_results,
company_trajectories). The [Inputs and
Outputs](https://theia-finance-labs.github.io/trisk.analysis/articles/inputs-and-outputs.html)
describes their columns structure with a simple Trisk run, and the
definitions of Trisk input parameters.

### Scenarios data

We provide consolidated scenarios data from publicly available sources.
The [Download
Scenarios](https://theia-finance-labs.github.io/trisk.analysis/articles/download-scenarios.html)
vignette showcases how to access this data and explore available
scenarios.

> **Note** Application of the code requires availability of custom data
> for assets and financial data. Those inputs need to be pre-processed
> independantly, following the structure of the mock datasets presented
> in the vignettes.

## Analyses

An online version of those analyses is available on our apps portal
<https://apps.1in1000.com>

### Portfolio analysis

A wrapper function called
[`run_trisk_on_portfolio()`](reference/run_trisk_on_portfolio.md) can be
used to run Trisk on a subset of the input assets dataframe, based on
companies that can be matched between the two. Along with PDs and NPVs
computed in the model the function also returns the expected loss,
computed using the loss given default provided in the input portfolio.
Plots to visualize the results are included in the package. Example
showcased in the [Portfolio
Analysis](https://theia-finance-labs.github.io/trisk.analysis/articles/portfolio-analysis.html)
vignette.

### Sensitivity analysis

A wrapper function called [`run_trisk_sa()`](reference/run_trisk_sa.md)
is provided if you’d like to generate a set of Trisk runs with different
parameters configurations. The results obtained can be plotted using
functions included in the package, or integrated in your analysis
pipeline. Example showcased in the [Sensitivity
Analysis](https://theia-finance-labs.github.io/trisk.analysis/articles/sensitivity-analysis.html)
vignette.

## Funding

EU LIFE Project Grant

Co-funded by the European Union. Views and opinions expressed are
however those of the author(s) only and do not necessarily reflect those
of the European Union or CINEA. Neither the European Union nor the
granting authority can be held responsible for them.

Scientific Transition Risk Exercises for Stress tests & Scenario
Analysis has received funding from the European Union’s Life programme
under Grant No. LIFE21-GIC-DE-Stress under the LIFE-2021-SAP-CLIMA
funding call.

![](inst/LifeLogo2.jpg)

# Package index

## All functions

- [`add_exposure_share_from_npv()`](add_exposure_share_from_npv.md) :
  Compute exposure shares from baseline NPV
- [`aggregate_facts()`](aggregate_facts.md) : Title
- [`aggregate_facts_portfolio()`](aggregate_facts_portfolio.md) : Title
- [`aggregate_facts_trisk()`](aggregate_facts_trisk.md) : Title
- [`aggregate_simple_portfolio()`](aggregate_simple_portfolio.md) :
  Aggregate simple portfolio input rows
- [`aggregate_simple_portfolio_results()`](aggregate_simple_portfolio_results.md)
  : Aggregate simple portfolio tech details back to input-row shape
- [`aggregate_trajectories_facts()`](aggregate_trajectories_facts.md) :
  Aggregate numerical trajectories columns
- [`aggregate_trisk_outputs_simple()`](aggregate_trisk_outputs_simple.md)
  : Aggregate TRISK outputs for simple portfolio analysis
- [`check_portfolio()`](check_portfolio.md) : Check Portfolio and Match
  Company IDs
- [`check_portfolio_simple()`](check_portfolio_simple.md) : Check Simple
  Portfolio
- [`compute_analysis_metrics()`](compute_analysis_metrics.md) : Compute
  Analysis Metrics
- [`compute_simple_portfolio_metrics()`](compute_simple_portfolio_metrics.md)
  : Compute value-change and expected-loss metrics on exposure shares
- [`download_trisk_inputs()`](download_trisk_inputs.md) : Download TRISK
  input data files from a specified endpoint
- [`draw_crispy_npv_change_plot()`](draw_crispy_npv_change_plot.md) :
  Construct NPV Change Visualization Plot
- [`draw_exposure_change_plot()`](draw_exposure_change_plot.md) :
  Generate Exposure Change and Value Loss Plot
- [`draw_pd_term_plot()`](draw_pd_term_plot.md) : Generate Plot of PD
  Values by Term and Scenario
- [`draw_trisk_line_plot()`](draw_trisk_line_plot.md) : Draw Line Plot
  for Risk Trajectories
- [`fuzzy_match_company_ids()`](fuzzy_match_company_ids.md) : Fuzzy
  Match Company IDs
- [`get_available_parameters()`](get_available_parameters.md) : Get the
  possible parameters values for Trisk from the scenario data
- [`get_filtered_assets_data()`](get_filtered_assets_data.md) : Filter
  assets based on provided criteria
- [`join_simple_portfolio_to_trisk()`](join_simple_portfolio_to_trisk.md)
  : Join simple portfolio to aggregated TRISK outputs
- [`join_trisk_outputs_to_portfolio()`](join_trisk_outputs_to_portfolio.md)
  : Join TRISK Outputs to Portfolio
- [`pipeline_crispy_expected_loss_plot()`](pipeline_crispy_expected_loss_plot.md)
  : Financial Risk Visualization via Expected Loss and Exposure Plot
- [`pipeline_crispy_exposure_change_plot()`](pipeline_crispy_exposure_change_plot.md)
  : Visualize Exposure and Value Loss Changes
- [`pipeline_crispy_npv_change_plot()`](pipeline_crispy_npv_change_plot.md)
  : Visualize Sector-wise NPV Percentage Changes
- [`pipeline_crispy_pd_term_plot()`](pipeline_crispy_pd_term_plot.md) :
  Visualize PD Values by Term and Business Unit
- [`plot_multi_trajectories()`](plot_multi_trajectories.md) : Visualize
  Trajectory Risks Over Time by Business Unit and Sector
- [`prepare_for_crispy_npv_change_plot()`](prepare_for_crispy_npv_change_plot.md)
  : Prepare Data for NPV Change Visualization
- [`prepare_for_expected_loss_plot()`](prepare_for_expected_loss_plot.md)
  : Data Preparation for Financial Risk Visualization
- [`prepare_for_exposure_change_plot()`](prepare_for_exposure_change_plot.md)
  : Preprocess Data for Exposure and Value Loss Visualization
- [`prepare_for_pd_term_plot()`](prepare_for_pd_term_plot.md) : Prepare
  Data for PD Term Visualization
- [`prepare_for_trisk_line_plot()`](prepare_for_trisk_line_plot.md) :
  Prepare Data for Risk Trajectory Line Plot
- [`run_trisk_agg()`](run_trisk_agg.md) : Run TRISK Model with
  Aggregated Results
- [`run_trisk_from_db()`](run_trisk_from_db.md) : Fetch Data from
  PostgreSQL and Run Transition Risk Aggregation
- [`run_trisk_model`](run_trisk_model.md) : run_trisk_model
- [`run_trisk_on_portfolio()`](run_trisk_on_portfolio.md) : Run TRISK
  Model on Portfolio
- [`run_trisk_on_simple_portfolio()`](run_trisk_on_simple_portfolio.md)
  : Run TRISK Model on Simple Portfolio
- [`run_trisk_sa()`](run_trisk_sa.md) : Run TRISK sensitivity analysis
  on multiple scenarios

# Articles

### All vignettes

- [download-scenarios](download-scenarios.md):
- [inputs-and-outputs](inputs-and-outputs.md):
- [portfolio-analysis](portfolio-analysis.md):
- [return-company-aggregated-results](return-company-aggregated-results.md):
- [sensitivity-analysis](sensitivity-analysis.md):
- [simple-portfolio-analysis](simple-portfolio-analysis.md):
